
<html>
    <head>
        <meta charset="utf-8" />
        <style type="text/css">
            .td_ceros{ mso-number-format:"\@";}
            
        </style>
    </head>
    <body>
        <table>
            <thead>
                <tr style="background:#eee;">
                    <th>idFicha_Venta_RH</th>
                    <th>idFicha_Venta_Principal</th>                    
                    <th>Fecha Venta</th>
                    <th>Hora_Venta</th>
                    <!-- 1.- Datos Entel-->
                    <th>DE_Telf_Llamada_Venta</th>
                    <th>DE_Base_Llamada</th>
                    <th>DE_Campana_Netcall</th>
                    <th>DE_Sub_Campana</th>
                    <th>DE_Detalle_Sub_Campana</th>
                    <th>DE_CF_Max_Linea_Movil</th>
                    <th>DE_Tipo_Etiqueta</th>
                    <th>DE_CF_Max_Linea_Pack</th>
                    <th>DE_Monto_Disp_Finan_Equipos</th>
                    <th>DE_Cant_Meses_Finan_Equipos</th>
                    <th>DE_Cliente_Entel</th>
                    <th>DE_Cliente_Promo_Dscto</th>
                    <!-- 2.- Datos Personales Cliente-->
                    <th>DP_TipoDocumento</th>
                    <th>DP_Documento</th>
                    <th>DP_Nombre_Cliente</th>
                    <th>DP_Apellido_Paterno</th>
                    <th>DP_Apellido_Materno</th>
                    <th>DP_Nacionalidad</th>
                    <th>DP_Lugar_Nacimiento</th>
                    <th>DP_Fecha_Nacimiento</th>
                    <th>DP_Nombre_Padre</th>
                    <th>DP_Nombre_Madre</th>
                    <!-- 3.- Registro de Venta-->
                    <th>RV_Tipo_Ofrecimiento</th>
                    <th>RV_Tipo_Venta</th>
                    <th>RV_Operador_Cedente</th>
                    <th>RV_Origen</th>
                    <th>RV_Linea_Portar</th>
                    <th>RV_Plan_Tarifario</th>
                    <th>RV_Cargo_Fijo_Plan</th>
                    <th>RV_Tipo_Producto</th>
                    <th>RV_Accesorio_Regalo</th>
                    <th>RV_SKU_Accesorio_Regalo1</th>
                    <th>RV_SKU_Accesorio_Regalo2</th>
                    <th>RV_SKU_Pack</th>
                    <th>RV_Precio_Equipo_Inicial_Total</th>
                    <th>RV_Cuota_Equipo_Mensual</th>
                    <th>RV_Cant_Accesorios</th>
                    <th>RV_SKU_Accesorio1</th>
                    <th>RV_Precio_Accesorio1</th>
                    <th>RV_SKU_Accesorio2</th>
                    <th>RV_Precio_Accesorio2</th>
                    <th>RV_SKU_Accesorio3</th>
                    <th>RV_Precio_Accesorio3</th>
                    <th>RV_SKU_Accesorio4</th>
                    <th>RV_Precio_Accesorio4</th>
                    <th>RV_SKU_Accesorio5</th>
                    <th>RV_Precio_Accesorio5</th>
                    <th>RV_Tipo_Pago</th>
                    <th>RV_Promociones_Bancos</th>
                    <!-- 4.- Datos Facturación-->
                    <th>DF_Email_Facturacion_Otros</th>
                    <th>DF_Dpto_Facturacion</th>
                    <th>DF_Prov_Facturacion</th>
                    <th>DF_Dist_Facturacion</th>
                    <th>DF_Domicilio_Facturacion</th>
                    <!-- 5.- Registro para Entrega-->
                    <th>RE_Tipo_Despacho</th>
                    <th>RE_Rango_Entrega_Despacho</th>
                    <th>RE_Rango_Horario_Despacho</th>
                    <th>RE_Tienda_Retiro</th>
                    <th>RE_Retail_Retiro</th>
                    <th>RE_Fecha_Entrega</th>
                    <th>SLA_Entrega</th>
                    <th>RE_Venta_Entrega_para</th>
                    <th>RE_Venta_Destino_para</th>
                    <th>RE_Dpto_Entrega_Producto</th>
                    <th>RE_Prov_Entrega_Producto</th>
                    <th>RE_Dist_Entrega_Producto</th>
                    <th>RE_Tipo_Direccion_Entrega</th>
                    <th>RE_Direccion_Entrega</th>
                    <th>RE_Referencia_Principales</th>
                    <th>RE_Referencias_Adicionales</th>
                    <th>RE_Coordenadas_Direccion_Entrega</th>
                    <th>RE_Telefono_Contacto1</th>
                    <th>RE_Telefono_Contacto2</th>
                    <th>RE_Tipo_Contacto_Ol</th>
                    <!-- 6 y 7.- A Cargo de | Comentarios-->
                    <th>Supervisor_Vendedor</th>
                    <th>Comentarios_Vendedor</th>
                    <th>Documento_Vendedor</th>
                    <th>Nombre_Vendedor</th>
                    <!-- BackOffice-->
                    <th>VBO_Estado_Venta_BO</th>
                    <th>VBO_Sub_Estado_Venta_BO</th>
                    <th>RBO_Cantidad_Ordenes_Ficha</th>
                    <th>RBO_Orden_One_Click1</th>
                    <th>RBO_Orden_One_Click2</th>
                    <th>RBO_Orden_One_Click3</th>
                    <th>FBO_Ficha_Limpia</th>
                    <th>FBO_Errores_Comunes_Ficha</th>
                    <th>DGBO_Tipo_Atencion_Final</th>
                    <th>DGBO_BO_Doc_Validador_Gestor</th>
                    <th>DGBO_BO_Validador_Gestor</th>
                    <th>DGBO_BO_Doc_Recupero_Repro_Gestor</th>
                    <th>DGBO_BO_Recupero_Repro_Gestor</th>
                    <th>Comentarios_BackOffice</th>
                    <th>Fecha_Ult_Actualizacion</th>
                    <th>Doc_BackOffice_Ult_Actualizacion</th>
                    <th>BackOffice_Ult_Actualizacion</th>
                </tr>
            </thead>

<?php 
$SubCategorias=$this->Consultas("SELECT * from subcategoria");
$arraySubCat = array();

foreach ($SubCategorias as $item ) {
    $arraySubCat[$item['idSubCategoria']]['idSubCategoria']=$item['idSubCategoria'];
    $arraySubCat[$item['idSubCategoria']]['Nombre']=$item['Nombre'];
}


$Personas=$this->Consultas("SELECT idPersona,Documento,CONCAT(persona.Primer_Nombre,' ',persona.Segundo_Nombre,' ',persona.Apellido_Paterno,' ',persona.Apellido_Materno) as 'NombrePersona' from persona");
$arrayPersona = array();
$arrayPersona[0]['idPersona']="";
$arrayPersona[0]['NombrePersona']="";
$arrayPersona[0]['Documento']="";
foreach ($Personas as $item ) {
    $arrayPersona[$item['idPersona']]['idPersona']=$item['idPersona'];
    $arrayPersona[$item['idPersona']]['NombrePersona']=$item['NombrePersona'];
    $arrayPersona[$item['idPersona']]['Documento']=$item['Documento'];
}

$Ubigeos=$this->Consultas("SELECT * from Ubigeo");

$arrayDist  = array();
$arrayProv = array();
$arrayDpto  = array(); 
foreach ($Ubigeos as $item ) {
    $arrayDist[$item['idUbigeo']]['Cod_Dist']=$item['idUbigeo'];
    $arrayDist[$item['idUbigeo']]['Descripcion']=$item['Descripcion'];
    if ($item['Tipo_Ubigeo']=='DPTO') {
        $arrayDpto[$item['Cod_Dpto']]['Cod_Dpto']=$item['Cod_Prov'];
        $arrayDpto[$item['Cod_Dpto']]['Descripcion']=$item['Descripcion'];
    }

    if ($item['Tipo_Ubigeo']=='PROV') {
        $arrayProv[$item['Cod_Prov']]['Cod_Prov']=$item['Cod_Prov'];
        $arrayProv[$item['Cod_Prov']]['Descripcion']=$item['Descripcion'];
    }

}



$Fichas_Venta=$this->Consultas("SELECT idFicha_Venta_RH,Ficha_Venta_id
,DE_Telf_Llamada_Venta
,DE_Base_Llamada
,DE_Campana_Netcall
,DE_Sub_Campana
,DE_Detalle_Sub_Campana
,DE_CF_Max_Linea_Movil
,DE_Tipo_Etiqueta
,DE_CF_Max_Linea_Pack
,DE_Monto_Disp_Finan_Equipos
,DE_Cant_Meses_Finan_Equipos
,DE_Cliente_Entel
,DE_Cliente_Promo_Dscto
,cliente.TipoDocumento as 'DP_TipoDocumento'
,cliente.Documento as 'DP_Documento'
,cliente.Nombre_Cliente as 'DP_Nombre_Cliente'
,cliente.Apellido_Paterno as 'DP_Apellido_Paterno'
,cliente.Apellido_Materno as 'DP_Apellido_Materno'
,cliente.Nacionalidad as 'DP_Nacionalidad'
,cliente.Lugar_Nacimiento as 'DP_Lugar_Nacimiento'
,cliente.Fecha_Nacimiento as 'DP_Fecha_Nacimiento'
,cliente.Nombre_Padre as 'DP_Nombre_Padre'
,cliente.Nombre_Madre as 'DP_Nombre_Madre'
,DF_Email_Facturacion_Otros
,DF_Ubigeo_Facturacion as 'DF_Dist_Facturacion'
,DF_Domicilio_Facturacion
,RE_Tipo_Despacho
,RE_Rango_Entrega_Despacho
,RE_Rango_Horario_Despacho
,RE_Tienda_Retiro
,RE_Retail_Retiro
,RE_Fecha_Entrega
,DATEDIFF(RE_Fecha_Entrega,Fecha_Registro_Vendedor) as 'SLA_Entrega'
,RE_Venta_Entrega_para
,RE_Venta_Destino_para
,RE_Ubigeo_Entrega as 'RE_Dist_Entrega_Producto'
,RE_Tipo_Direccion_Entrega
,RE_Direccion_Entrega
,RE_Referencia_Principales
,RE_Referencias_Adicionales
,RE_Coordenadas_Direccion_Entrega
,RE_Telefono_Contacto1
,RE_Telefono_Contacto2
,RE_Tipo_Contacto_Ol
,RV_Tipo_Ofrecimiento
,RV_Tipo_Venta
,RV_Operador_Cedente
,RV_Origen
,RV_Linea_Portar
,RV_Plan_Tarifario
,RV_Cargo_Fijo_Plan
,RV_Tipo_Producto
,RV_Accesorio_Regalo
,RV_SKU_Accesorio_Regalo1
,RV_SKU_Accesorio_Regalo2
,RV_SKU_Pack
,RV_Precio_Equipo_Inicial_Total
,RV_Cuota_Equipo_Mensual
,RV_Cant_Accesorios
,RV_SKU_Accesorio1
,RV_Precio_Accesorio1
,RV_SKU_Accesorio2
,RV_Precio_Accesorio2
,RV_SKU_Accesorio3
,RV_Precio_Accesorio3
,RV_SKU_Accesorio4
,RV_Precio_Accesorio4
,RV_SKU_Accesorio5
,RV_Precio_Accesorio5
,RV_Tipo_Pago
,RV_Promociones_Bancos
,Supervisor_Vendedor
,Comentarios_Vendedor
,vendedor.Documento as Documento_Vendedor
,CONCAT(vendedor.Primer_Nombre,' ',vendedor.Segundo_Nombre,' ',vendedor.Apellido_Paterno,' ',vendedor.Apellido_Materno) as Nombre_Vendedor
,DATE(ficha_venta.Fecha_Registro_Vendedor) as Fecha_Venta
,TIME(ficha_venta.Fecha_Registro_Vendedor) as Hora_Venta
,VBO_Estado_Venta_BO
,VBO_Sub_Estado_Venta_BO
,RBO_Cantidad_Ordenes_Ficha
,RBO_Orden_One_Click1
,RBO_Orden_One_Click2
,RBO_Orden_One_Click3
,FBO_Ficha_Limpia
,FBO_Errores_Comunes_Ficha
,DGBO_Tipo_Atencion_Final
,DGBO_BO_Validador_Gestor
,DGBO_BO_Recupero_Repro_Gestor
,Comentarios_BackOffice
,Fecha_Modificacion_BackOffice as Fecha_Ult_Actualizacion
,Modificado_por_BackOffice as BackOffice_Ult_Actualizacion
 FROM ficha_venta_rh as ficha_venta
inner join cliente on cliente.idCliente=ficha_venta.Cliente_id
left join usuario as usuario on usuario.idUsuario=ficha_venta.Ingresado_por_Vendedor
left join persona as vendedor on vendedor.idPersona=usuario.Persona_id
 where ficha_venta.Eliminado=0 and DATE(ficha_venta.Fecha_Modificacion_BackOffice)>='".$FechaInicio."' and DATE(ficha_venta.Fecha_Modificacion_BackOffice)<='".$FechaFin."' order by ficha_venta.Fecha_Modificacion_BackOffice"); 


?>


            <?php foreach($Fichas_Venta as $item): ?>
                <tr>
                    <td><?php echo $item ['idFicha_Venta_RH'];?></td>
                    <td><?php echo $item ['Ficha_Venta_id'];?></td>
                    <td><?php echo $item['Fecha_Venta'];?></td>
                    <td><?php echo $item['Hora_Venta'];?></td>
                    <!-- 1.- Datos Entel-->
                    <td><?php echo $item ['DE_Telf_Llamada_Venta'];?></td>
                    <td><?php echo $arraySubCat[$item['DE_Base_Llamada']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['DE_Campana_Netcall']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['DE_Sub_Campana']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['DE_Detalle_Sub_Campana']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['DE_CF_Max_Linea_Movil']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['DE_Tipo_Etiqueta']]['Nombre'];?></td>
                    <td><?php echo $item['DE_CF_Max_Linea_Pack'];?></td>
                    <td><?php echo $item['DE_Monto_Disp_Finan_Equipos'];?></td>
                    <td><?php echo $arraySubCat[$item['DE_Cant_Meses_Finan_Equipos']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['DE_Cliente_Entel']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['DE_Cliente_Promo_Dscto']]['Nombre'];?></td>
                    <!-- 2.- Datos Cliente-->
                    <td><?php echo $arraySubCat[$item['DP_TipoDocumento']]['Nombre'];?></td>
                    <td class="td_ceros"><?php echo $item ['DP_Documento'];?></td>
                    <td><?php echo $item['DP_Nombre_Cliente'];?></td>
                    <td><?php echo $item['DP_Apellido_Paterno'];?></td>
                    <td><?php echo $item['DP_Apellido_Materno'];?></td>
                    <td><?php echo $item['DP_Nacionalidad'];?></td>
                    <td><?php echo $item['DP_Lugar_Nacimiento'];?></td>
                    <td><?php echo $item['DP_Fecha_Nacimiento'];?></td>
                    <td><?php echo $item['DP_Nombre_Padre'];?></td>
                    <td><?php echo $item['DP_Nombre_Madre'];?></td>
                    <!-- 3.- Registro de Venta-->
                    <td><?php echo $arraySubCat[$item['RV_Tipo_Ofrecimiento']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['RV_Tipo_Venta']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['RV_Operador_Cedente']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['RV_Origen']]['Nombre'];?></td>
                    <td><?php echo $item['RV_Linea_Portar'];?></td>
                    <td><?php echo $arraySubCat[$item['RV_Plan_Tarifario']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['RV_Cargo_Fijo_Plan']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['RV_Tipo_Producto']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['RV_Accesorio_Regalo']]['Nombre'];?></td>
                    <td><?php echo $item['RV_SKU_Accesorio_Regalo1'];?></td>
                    <td><?php echo $item['RV_SKU_Accesorio_Regalo2'];?></td>
                    <td><?php echo $item['RV_SKU_Pack'];?></td>
                    <td><?php echo $item['RV_Precio_Equipo_Inicial_Total'];?></td>
                    <td><?php echo $item['RV_Cuota_Equipo_Mensual'];?></td>
                    <td><?php echo $arraySubCat[$item['RV_Cant_Accesorios']]['Nombre'];?></td>
                    <td><?php echo $item['RV_SKU_Accesorio1'];?></td>
                    <td><?php echo $item['RV_Precio_Accesorio1'];?></td>
                    <td><?php echo $item['RV_SKU_Accesorio2'];?></td>
                    <td><?php echo $item['RV_Precio_Accesorio2'];?></td>
                    <td><?php echo $item['RV_SKU_Accesorio3'];?></td>
                    <td><?php echo $item['RV_Precio_Accesorio3'];?></td>
                    <td><?php echo $item['RV_SKU_Accesorio4'];?></td>
                    <td><?php echo $item['RV_Precio_Accesorio4'];?></td>
                    <td><?php echo $item['RV_SKU_Accesorio5'];?></td>
                    <td><?php echo $item['RV_Precio_Accesorio5'];?></td>
                    <td><?php echo $arraySubCat[$item['RV_Tipo_Pago']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['RV_Promociones_Bancos']]['Nombre'];?></td>
                    <!-- 4 Datos Datos Facturación-->
                    <td><?php echo $item['DF_Email_Facturacion_Otros'];?></td>
                    <?php 
                        $DF_Dist_Facturacion=str_pad($item['DF_Dist_Facturacion'],6,"0", STR_PAD_LEFT); 
                        $DF_Prov_Facturacion=substr($DF_Dist_Facturacion,0,4);
                        $DF_Dpto_Facturacion=substr($DF_Dist_Facturacion,0,2);
                    ?>
                    <td><?php echo $arrayDpto[$DF_Dpto_Facturacion]['Descripcion'];?></td>
                    <td><?php echo $arrayProv[$DF_Prov_Facturacion]['Descripcion'];?></td>
                    <td><?php echo $arrayDist[$item['DF_Dist_Facturacion']]['Descripcion'];?></td>
                    <td><?php echo $item['DF_Domicilio_Facturacion'];?></td>
                    <!-- 5.- Registro para Entrega-->
                    <td><?php echo $arraySubCat[$item['RE_Tipo_Despacho']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['RE_Rango_Entrega_Despacho']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['RE_Rango_Horario_Despacho']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['RE_Tienda_Retiro']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['RE_Retail_Retiro']]['Nombre'];?></td>
                    <td><?php echo $item['RE_Fecha_Entrega'];?></td>
                    <td><?php echo $item['SLA_Entrega'];?></td>                    
                    <td><?php echo $arraySubCat[$item['RE_Venta_Entrega_para']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['RE_Venta_Destino_para']]['Nombre'];?></td>
                    <?php 
                        $DF_Dist_Entrega=str_pad($item['RE_Dist_Entrega_Producto'],6,"0", STR_PAD_LEFT); 
                        $DF_Prov_Entrega=substr($DF_Dist_Entrega,0,4);
                        $DF_Dpto_Entrega=substr($DF_Dist_Entrega,0,2);
                    ?>
                    <td><?php echo $arrayDpto[$DF_Dpto_Entrega]['Descripcion'];?></td>
                    <td><?php echo $arrayProv[$DF_Prov_Entrega]['Descripcion'];?></td>
                    <td><?php echo $arrayDist[$item['RE_Dist_Entrega_Producto']]['Descripcion'];?></td>
                    <td><?php echo $arraySubCat[$item['RE_Tipo_Direccion_Entrega']]['Nombre'];?></td>
                    <td><?php echo $item['RE_Direccion_Entrega'];?></td>
                    <td><?php echo $item['RE_Referencia_Principales'];?></td>
                    <td><?php echo $item['RE_Referencias_Adicionales'];?></td>
                    <td><?php echo $item['RE_Coordenadas_Direccion_Entrega'];?></td>
                    <td><?php echo $item['RE_Telefono_Contacto1'];?></td>
                    <td><?php echo $item['RE_Telefono_Contacto2'];?></td>
                    <td><?php echo $arraySubCat[$item['RE_Tipo_Contacto_Ol']]['Nombre'];?></td>
                    <!-- 6 y 7.- A Cargo de | Comentarios-->
                    <td><?php echo $arrayPersona[$item['Supervisor_Vendedor']]['NombrePersona'];?></td>
                    <td><?php echo $item['Comentarios_Vendedor'];?></td>
                    <td class="td_ceros"><?php echo $item['Documento_Vendedor'];?></td>
                    <td><?php echo $item['Nombre_Vendedor'];?></td>
                     <!-- Back office-->
                    <td><?php echo $arraySubCat[$item['VBO_Estado_Venta_BO']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['VBO_Sub_Estado_Venta_BO']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['RBO_Cantidad_Ordenes_Ficha']]['Nombre'];?></td>
                    <td><?php echo $item['RBO_Orden_One_Click1'];?></td>
                    <td><?php echo $item['RBO_Orden_One_Click2'];?></td>
                    <td><?php echo $item['RBO_Orden_One_Click3'];?></td>
                    <td><?php echo $arraySubCat[$item['FBO_Ficha_Limpia']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['FBO_Errores_Comunes_Ficha']]['Nombre'];?></td>
                    <td><?php echo $arraySubCat[$item['DGBO_Tipo_Atencion_Final']]['Nombre'];?></td>
                    <td class="td_ceros"><?php echo $arrayPersona[$item['DGBO_BO_Validador_Gestor']]['Documento'];?></td>
                    <td><?php echo $arrayPersona[$item['DGBO_BO_Validador_Gestor']]['NombrePersona'];?></td>
                    <td class="td_ceros"><?php echo $arrayPersona[$item['DGBO_BO_Recupero_Repro_Gestor']]['Documento'];?></td>
                    <td><?php echo $arrayPersona[$item['DGBO_BO_Recupero_Repro_Gestor']]['NombrePersona'];?></td>
                    <td><?php echo $item['Comentarios_BackOffice'];?></td>
                    <td><?php echo $item['Fecha_Ult_Actualizacion'];?></td>
                    <td class="td_ceros"><?php echo $arrayPersona[$item['BackOffice_Ult_Actualizacion']]['Documento'];?></td>
                    <td><?php echo $arrayPersona[$item['BackOffice_Ult_Actualizacion']]['NombrePersona'];?></td>
                </tr>
            <?php endforeach; ?>
        </table>

    </body>
</html>